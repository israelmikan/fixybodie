<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<!--
 Copyright 2010 Google Inc. 
 Licensed under the Apache License, Version 2.0: 
 http://www.apache.org/licenses/LICENSE-2.0 
 -->
<html>
<head>
<meta name="viewport" content="initial-scale=1.0, user-scalable=no"/>
<script>
  if (localStorage.orderkeysuper == null) {
        //...
                alert("You Dont have Any Current Orders");
      window.location.assign("../index.html");
      
      
      }else{
                
            }

  
</script>
<meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
   
<title>Special Order</title>
    <script src="https://cdn.firebase.com/js/client/2.4.2/firebase.js"></script>
    <script> 
        
        
function myFunction() {
   // alert("Refresh working");
    setInterval(function(){Track();},8000);
}
</script>
<script type="text/javascript">
    
    
         var watchID;
         var geoLoc;
         
         function showLocation(position) {
            var latitude = position.coords.latitude;
            var longitude = position.coords.longitude;
             localStorage.custlat=latitude;
             localStorage.custlong=longitude;
           
             //localStorage.bodalaty=latitude;
            //localstorage.bodalongy=longitude;
           // alert("Latitude : " + latitude + " Longitude: " + longitude);
             //alert("Customer atambudde Latitude : " + latitude + " Longitude: " + longitude);
             //localStorage.bodalaty=latitude;
            //localstorage.bodalongy=longitude;
           // alert("Pushing");
                var t=localStorage.nowkey;
                var ref = new Firebase("https://amhungry.firebaseio.com/supermarketorders/"+localStorage.orderkeysuper);
            // Retrieve new posts as they are added to our database

                      var onComplete = function(error) {
                  if (error) {
                    console.log('Synchronization failed');
                  } else {
                    console.log('Synchronization succeeded');
                     // alert('Order Details Updated');
                  }
                };
                  ref.update({ supermarket: localStorage.supermarket,customerlat: localStorage.custlat, customerlong:localStorage.custlong,bodabill:localStorage.bodabill,mine:localStorage.mine,hotelbill:localStorage.supertotal }, onComplete);
                    //alert('Details Updated');
             
               }
 
  
         function errorHandler(err) {
            if(err.code == 1) {
               alert("Error: Access is denied Turn Gps On!");
              // window.location.assign("getpoint.html");
            }
            
            else if( err.code == 2) {
               alert("Error: Position is unavailable!");
              //  window.location.assign("getpoint.html");
            }
         }
         
         function Track(){
            if(navigator.geolocation){
               // timeout at 60000 milliseconds (60 seconds)
               var options = {timeout:60000};
               geoLoc = navigator.geolocation;
               watchID = geoLoc.watchPosition(showLocation, errorHandler, options);
            }
            
            else{
               alert("Sorry, device does not support geolocation!");
            }
            
            //myFunction();
            // refreshData();
             
         }
function refreshData()
{
    x = 30;  // 5 Seconds
   //Track();

    setTimeout(refreshData, x*1000);
}refreshData();
    </script>
    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBKhOBqZP-Gej1xLry8_M7d8fZvp-E1FwA&callback=initMap">
    </script>
    </head>
   <body onload="Track();">
       <script>
       var laty=parseFloat(localStorage.custlat);
       var longy = parseFloat(localStorage.custlong);
      function initMap() {
        var uluru = {lat: laty, lng: longy};
        var map = new google.maps.Map(document.getElementById('map'), {
          zoom: 4,
          center: uluru
        });
        var marker = new google.maps.Marker({
          position: uluru,
          map: map
        });
      }
    </script>

    
         <script>
         function viewBoda(){
alert("View Boda");
popup('popUpDiv');
         }
                
                document.write("<table width='100%'>");
                
         
            
         
var ref = new Firebase("https://amhungry.firebaseio.com/supermarketorders/"+localStorage.orderkeysuper+"");
// Retrieve new posts as they are added to our database
ref.on("value", function(snapshot, prevChildKey) {
  var newPost = snapshot.val();
    var customer=newPost.customer;
    var subtotal=newPost.subTotal;
    var orderstatus=newPost.status;
    var orderkey=snapshot.key();
    localStorage.nowkey=orderkey;
    
    document.write("<div class='img-wrapper'><center><img src='../img/piss.png' alt='' width='40%' height='150px'></center></div><br><img src='../img/boda.png'>"); 
     document.write("<p>Delivery page</p>");
      document.write("<button onclick='viewBoda();'>View Boda</button>");
     document.write("<p>You Are required to keep on this page to monitor your order progress</p>");
    document.write("<div id='map'></div>");
        document.write("<table border='1' width='100%'><tr><td>"+customer+"</td><td>"+subtotal+"</td><td>"+orderstatus+"</td></tr></table>");  
   document.write("<table border='1'>");
 var ref1 = new Firebase("https://amhungry.firebaseio.com/supermarketorders/"+snapshot.key()+"/items");
  ref1.once("value", function(snapshot1) {
  
    snapshot1.forEach(function(childSnapshot) {
    // key will be "fred" the first time and "barney" the second time
    var key = childSnapshot.key();
    // childData will be the actual contents of the child
    var childData = childSnapshot.val();
        var itemtitle=childData.title;
        var price=childData.price;
        var qty=childData.quantity;
        
        document.write("<tr><td>Item name:"+itemtitle+"</td><td>Quantity"+qty+"</td><td>Price:"+price+"</td></tr>");
          


  
  });
document.write("</table>");
document.write("<center>&copy; All Rights Reserved Bodafix</center>");
  });
    
    
});


</script>
<style>#blanket {
background-color:#111;
opacity: 0.65;
*background:none;
position:absolute;
z-index: 9001;
top:0px;
left:0px;
width:100%;
}

#popUpDiv {
position:absolute;
background:url(pop-back.jpg) no-repeat;
width:400px;
height:400px;
border:5px solid #000;
z-index: 9002;
}</style>
<div id="blanket" style="display:none"></div>
<div id="popUpDiv" style="display:none">
<a href="#" onclick="popup('popUpDiv')" >Click to Close CSS Pop Up</a>
</div>
<a href="#" onclick="popup('popUpDiv')">Click to Open CSS Pop Up</a>
    <div id='map'></div>
    
    </body>


<script>
  function toggle(div_id) {
  var el = document.getElementById(div_id);
  if ( el.style.display == 'none' ) { el.style.display = 'block';}
  else {el.style.display = 'none';}
}
function blanket_size(popUpDivVar) {
  if (typeof window.innerWidth != 'undefined') {
    viewportheight = window.innerHeight;
  } else {
    viewportheight = document.documentElement.clientHeight;
  }
  if ((viewportheight > document.body.parentNode.scrollHeight) && (viewportheight > document.body.parentNode.clientHeight)) {
    blanket_height = viewportheight;
  } else {
    if (document.body.parentNode.clientHeight > document.body.parentNode.scrollHeight) {
      blanket_height = document.body.parentNode.clientHeight;
    } else {
      blanket_height = document.body.parentNode.scrollHeight;
    }
  }
  var blanket = document.getElementById('blanket');
  blanket.style.height = blanket_height + 'px';
  var popUpDiv = document.getElementById(popUpDivVar);
  popUpDiv_height=blanket_height/2-200;//200 is half popup's height
  popUpDiv.style.top = popUpDiv_height + 'px';
}
function window_pos(popUpDivVar) {
  if (typeof window.innerWidth != 'undefined') {
    viewportwidth = window.innerHeight;
  } else {
    viewportwidth = document.documentElement.clientHeight;
  }
  if ((viewportwidth > document.body.parentNode.scrollWidth) && (viewportwidth > document.body.parentNode.clientWidth)) {
    window_width = viewportwidth;
  } else {
    if (document.body.parentNode.clientWidth > document.body.parentNode.scrollWidth) {
      window_width = document.body.parentNode.clientWidth;
    } else {
      window_width = document.body.parentNode.scrollWidth;
    }
  }
  var popUpDiv = document.getElementById(popUpDivVar);
  window_width=window_width/2-200;//200 is half popup's width
  popUpDiv.style.left = window_width + 'px';
}
function popup(windowname) {
  blanket_size(windowname);
  window_pos(windowname);
  toggle('blanket');
  toggle(windowname);   
}
</script>
</html>